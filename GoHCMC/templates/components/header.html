{% load static %}
<header class="header">
  <div class="header__container">
    <div class="header__logo">
      <a href="{% url 'homepage' %}">
        <img
          src="{% static 'img/Logo_GoHCMC.png' %}"
          alt="GoHCMC Logo"
          class="header__logo-img"
        />
      </a>
    </div>
    <nav class="header__nav">
      <a
        href="{% url 'homepage' %}"
        class="nav-link {% if request.path == '/' %}active{% endif %}"
      >
        <i class="fas fa-house"></i> Home
      </a>
      <a
        href="{% url 'weather' %}"
        class="nav-link {% if '/weather' in request.path %}active{% endif %}"
      >
        <i class="fas fa-cloud-sun"></i> Weather
      </a>
      <a
        href="{% url 'locations' %}"
        class="nav-link {% if '/locations' in request.path %}active{% endif %}"
      >
        <i class="fas fa-map-pin"></i> Locations
      </a>
      <a
        href="{% url 'favourite' %}"
        class="nav-link {% if '/favourite' in request.path %}active{% endif %}"
      >
        <i class="fas fa-heart"></i> Favourite
      </a>
      <a
        href="{% url 'trip' %}"
        class="nav-link {% if '/trip' in request.path %}active{% endif %}"
      >
        <i class="fas fa-map"></i> My Trip
      </a>
    </nav>
    <div class="header__actions">
      <div class="header__search" id ="headerSearch">
        {% include 'components/searchbar.html' %}
      </div>
      <div class="theme-switch" id="themeSwitch" title="Đổi giao diện">
        <span class="theme-switch__icon" id="themeIcon">
          <i class="fa-solid fa-sun" id="icon-sun"></i>
          <i class="fa-solid fa-moon" id="icon-moon" style="display: none"></i>
        </span>
      </div>
    </div>
    <div class="header__user">
      {% if user.is_authenticated %}
      <button class="user-icon">
        <i class="fa-solid fa-user"></i>
        <span class="header__username"
          >{{ user.get_full_name|default:user.username }}</span
        >
        <i class="fa-solid fa-chevron-down"></i>
      </button>

      <div id="userMenu" class="user-menu">
        <a href="#">
          <i class="fa-solid fa-id-card"></i>
          <span>Profile</span>
        </a>
        <a href="#">
          <i class="fa-solid fa-gear"></i>
          <span>Setting</span>
        </a>
        <a href="{% url 'logout' %}">
          <i class="fa-solid fa-right-from-bracket"></i>
          <span>Logout</span>
        </a>
      </div>
      {% else %}
      <a href="/login/"
        ><button class="button button-secondary">Login</button></a
      >
      <a href="/signup/"
        ><button class="button button-primary">Sign Up</button></a
      >
      {% endif %}
    </div>
  </div>
</header>
<script>
  // Theme switch logic
  const themeSwitch = document.getElementById("themeSwitch");
  const themeIconSun = document.getElementById("icon-sun");
  const themeIconMoon = document.getElementById("icon-moon");
  function setTheme(theme) {
    document.documentElement.setAttribute("data-theme", theme);
    if (theme === "dark") {
      themeIconSun.style.display = "none";
      themeIconMoon.style.display = "inline";
      themeSwitch.setAttribute("data-theme", "dark");
    } else {
      themeIconSun.style.display = "inline";
      themeIconMoon.style.display = "none";
      themeSwitch.setAttribute("data-theme", "light");
    }
    localStorage.setItem("theme", theme);
  }
  themeSwitch.onclick = function () {
    const current = document.documentElement.getAttribute("data-theme");
    setTheme(current === "dark" ? "light" : "dark");
  };
  // Load theme from localStorage
  (function () {
    const saved = localStorage.getItem("theme");
    setTheme(saved === "dark" ? "dark" : "light");
  })();

  // User menu dropdown logic
  (function () {
    const userBtn = document.querySelector(".header__user button");
    const userMenu = document.getElementById("userMenu");
    if (!userBtn || !userMenu) return;

    function showMenu() {
      userMenu.classList.add("open");
      userMenu.setAttribute("aria-hidden", "false");
    }
    function hideMenu() {
      userMenu.classList.remove("open");
      userMenu.setAttribute("aria-hidden", "true");
    }

    userBtn.addEventListener("click", function (e) {
      e.stopPropagation();
      if (userMenu.classList.contains("open")) {
        hideMenu();
      } else {
        showMenu();
      }
    });

    document.addEventListener("click", function (e) {
      if (!userMenu.contains(e.target) && !userBtn.contains(e.target)) {
        hideMenu();
      }
    });

    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape") hideMenu();
    });
  })();
</script>
