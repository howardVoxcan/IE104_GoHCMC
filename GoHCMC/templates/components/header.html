{% load static %}
<header class="header">
  <div class="header__logo">
    <a href="#">
      <img src="{% static 'img/Logo_GoHCMC.png' %}" alt="GoHCMC Logo" class="header__logo-img">
    </a>
  </div>
  <nav class="header__nav-tabs">
    <a href="#" class="header__nav-link {% if request.resolver_match.url_name == 'homepage' %}active{% endif %}">
      <i class="fas fa-house"></i> Home
    </a>
    <a href="#" class="header__nav-link {% if request.resolver_match.url_name == 'weather' %}active{% endif %}">
      <i class="fas fa-cloud-sun"></i> Weather
    </a>
    <a href="#" class="header__nav-link {% if request.resolver_match.url_name == 'locations' %}active{% endif %}">
      <i class="fas fa-map-pin"></i> Locations
    </a>
    <a href="#" class="header__nav-link {% if request.resolver_match.url_name == 'favourite' %}active{% endif %}">
      <i class="fas fa-heart"></i> Favourite
    </a>
    <a href="#" class="header__nav-link {% if request.resolver_match.url_name == 'my_trip' %}active{% endif %}">
      <i class="fas fa-map"></i> My Trip
    </a>
  </nav>
  <div class="header__actions">
    <div class="header__search-bar" id="searchBar">
      <button type="button" class="header__search-icon" id="searchToggle">
        <i class="fas fa-search"></i>
      </button>
      <form method="get" action="#" class="header__search-form" id="searchForm" style="display:none;">
        <input type="text" name="search" placeholder="Searching..."
          value="{{ current_filters.search|default_if_none:'' }}" class="header__search-input">
        <button type="submit" class="header__search-button">
          <i class="fas fa-search"></i>
        </button>
      </form>
    </div>
    <div class="theme-switch" id="themeSwitch" title="Đổi giao diện">
      <span class="theme-switch__icon" id="themeIcon">
        <i class="fa-solid fa-sun" id="icon-sun"></i>
        <i class="fa-solid fa-moon" id="icon-moon" style="display:none;"></i>
      </span>
    </div>
  </div>
  {% if not user.is_authenticated %}
  <div class="header__nav-buttons">
    <a href="#"><button class="header__nav-button header__nav-button--secondary">Sign In</button></a>
    <a href="#"><button class="header__nav-button header__nav-button--primary">Sign Up</button></a>
  </div>
  {% else %}
  <div class="header__user-block">
    <div class="header__dropbtn">
      {{user.username}}
      <i class="far fa-user-circle"></i>
    </div>
    <form action="#" method="post" style="display: inline;">
      {% csrf_token %}
      <a href="#"><button type="submit" class="header__logout-button">Log Out</button></a>
    </form>
  </div>
  {% endif %}
</header>
<script>
  // Theme switch logic
  const themeSwitch = document.getElementById('themeSwitch');
  const themeIconSun = document.getElementById('icon-sun');
  const themeIconMoon = document.getElementById('icon-moon');
  function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    if (theme === 'dark') {
      themeIconSun.style.display = 'none';
      themeIconMoon.style.display = 'inline';
      themeSwitch.setAttribute('data-theme', 'dark');
    } else {
      themeIconSun.style.display = 'inline';
      themeIconMoon.style.display = 'none';
      themeSwitch.setAttribute('data-theme', 'light');
    }
    localStorage.setItem('theme', theme);
  }
  themeSwitch.onclick = function() {
    const current = document.documentElement.getAttribute('data-theme');
    setTheme(current === 'dark' ? 'light' : 'dark');
  };
  // Load theme from localStorage
  (function() {
    const saved = localStorage.getItem('theme');
    setTheme(saved === 'dark' ? 'dark' : 'light');
  })();

  // Search toggle logic
  const searchToggle = document.getElementById('searchToggle');
  const searchForm = document.getElementById('searchForm');
  searchToggle.onclick = function() {
    searchForm.style.display = 'flex';
    searchToggle.style.display = 'none';
    searchForm.querySelector('input').focus();
  };
  function hideSearchForm() {
    searchForm.style.display = 'none';
    searchToggle.style.display = 'inline-flex';
  }
  searchForm.querySelector('input').addEventListener('blur', function() {
    setTimeout(hideSearchForm, 150);
  });
  searchForm.addEventListener('submit', function(e) {
    hideSearchForm();
  });
</script>
