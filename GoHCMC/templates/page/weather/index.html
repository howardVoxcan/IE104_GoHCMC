{% extends 'layout.html' %}
{% load static %}

{% block title %}Weather{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/weather.css' %}?v={{ timestamp }}">
{% endblock %}

{% block content %}
<div class="weather-wrapper">
    <!-- Cột trái: các ngày -->
    <div class="day-tabs">
        {% for day in forecast %}
            <button class="tab-btn {% if forloop.first %}active{% endif %}" data-day="{{ forloop.counter0 }}">
                {{ day.date }}
            </button>
        {% endfor %}
    </div>

    <!-- Cột phải: Chart + Box chi tiết -->
    <div class="forecast-right">
        {% for day in forecast %}
        <div class="forecast-display" id="day-panel-{{ forloop.counter0 }}" {% if not forloop.first %}style="display:none"{% endif %}>
            
            <!-- Chart -->
            <div class="chart-image-container">
                <img src="{{ day.chart_image }}" alt="Biểu đồ thời tiết {{ day.date }}">
            </div>

            <!-- Box giờ -->
            <div class="detail-box">
                {% for period in day.periods %}
                <div class="forecast-period">
                    <p><strong>{{ period.time }}</strong></p>
                    <img src="{{ period.icon }}" alt="{{ period.condition }}">
                    <p>{{ period.temp_c }}°C</p>
                    <p>{{ period.condition }}</p>
                </div>
                {% endfor %}
            </div>

        </div>
        {% endfor %}
    </div>
</div>

<script>
const tabButtons = document.querySelectorAll('.tab-btn');
const dayPanels = document.querySelectorAll('.forecast-display');

tabButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
        const dayIndex = btn.getAttribute('data-day');

        // Ẩn tất cả panel
        dayPanels.forEach(panel => panel.style.display = 'none');
        tabButtons.forEach(b => b.classList.remove('active'));

        // Hiện panel tương ứng
        const targetPanel = document.getElementById(`day-panel-${dayIndex}`);
        if (targetPanel) targetPanel.style.display = 'flex';
        btn.classList.add('active');
    });
});
</script>
{% endblock %}
